# Разработка корпоративных приложений

## Задание

### Цель
Реализация проекта сервисно-ориентированного приложения.

### Предметная область «Пункт велопроката»
В базе пункта проката хранятся сведения о велосипедах, их арендаторах и выданных в аренду транспортных средствах.

**Велосипед** характеризуется:
- Серийным номером
- Моделью
- Цветом

**Модель велосипеда** является справочником, содержащим сведения о:
- Типе велосипеда
- Размере колес
- Предельно допустимом весе пассажира
- Весе велосипеда
- Типе тормозов
- Модельном годе
- Цене часа аренды

**Тип велосипеда** является перечислением.

**Арендатор** характеризуется:
- ФИО
- Телефоном

**Аренда (контракт):**
- При выдаче велосипеда фиксируется время начала аренды
- Отмечается продолжительность аренды в часах

---

## Задание на лабораторную работу №1

### Подготовленная структура классов

#### Класс `Bike` (Велосипед)
| Поле | Описание |
|------|----------|
| `Id` | Уникальный идентификатор |
| `SerialNumber` | Серийный номер |
| `Model` | Модель |
| `Color` | Цвет |

#### Класс `BikeModel` (Модель велосипеда)
| Поле | Описание |
|------|----------|
| `Id` | Уникальный идентификатор |
| `Type` | Тип велосипеда |
| `WheelSize` | Размер колес |
| `MaxCyclistWeight` | Максимальный вес велосипедиста |
| `Weight` | Вес велосипеда |
| `BrakeType` | Тип тормозов |
| `YearOfManufacture` | Год выпуска модели |
| `RentPrice` | Цена часа аренды |

#### Класс `Renter` (Арендатор)
| Поле | Описание |
|------|----------|
| `Id` | Уникальный идентификатор |
| `FullName` | ФИО |
| `PhoneNumber` | Номер телефона |

#### Класс `Lease` (Контракт аренды)
| Поле | Описание |
|------|----------|
| `Id` | Уникальный идентификатор |
| `Renter` | Арендатор |
| `Bike` | Арендованный велосипед |
| `RentalStartTime` | Время начала аренды |
| `RentalDuration` | Продолжительность аренды (в часах) |

---

### Реализованные компоненты

#### 1. **Датасет** (`RentalFixture`)
- Включено по 10 экземпляров каждого класса

#### 2. **Юнит-тесты**

| Название теста | Описание |
|----------------|----------|
| `InfoAboutSportBikes` | Выводит информацию обо всех спортивных велосипедах |
| `TopFiveModelsIncome` | Выводит топ-5 моделей велосипедов по прибыли от аренды |
| `TopFiveModelsDuration` | Выводит топ-5 моделей велосипедов по длительности аренды |
| `MinMaxAvgRental` | Выводит минимальное, максимальное и среднее время аренды |
| `TotalRentalTimeByType` | Выводит суммарное время аренды велосипедов каждого типа |
| `TopThreeRenters` | Выводит информацию о клиентах, бравших велосипеды на прокат больше всего раз |

---
- .NET (C#)
- xUnit (для юнит-тестов)

# Лабораторные работы №2-3: REST API + ORM + Aspire

###  **База данных MySQL + EF Core**
- Доменные модели с внешними ключами:
    ```csharp
  public class Bike { 
      public int ModelId { get; set; }  // FK to BikeModel
      public virtual BikeModel Model { get; init; }
  }

* Репозитории с асинхронными методами 
* Миграции EF Core для создания схемы БД 
* Контекст ApplicationDbContext с конфигурациями 
#### **Генерация данных:**
```csharp
    new BikeModel
    {
         Type = faker.PickRandom<BikeType>(),           // Случайный тип из enum
         WheelSize = faker.Random.Int(20, 29),          // Размер колёс 20-29"
         MaxCyclistWeight = faker.Random.Int(60, 120),  // Вес 60-120 кг
         Weight = Math.Round(faker.Random.Double(7.0, 15.0), 2), // Вес велосипеда
         BrakeType = faker.PickRandom("Road", "Sport", "Mountain", "Hybrid"),
         YearOfManufacture = faker.Date.Past(10).Year.ToString(), // Год выпуска
         RentPrice = Math.Round(faker.Random.Decimal(5.0m, 20.0m), 2) // Цена аренды
    }
```
Bogus генерировал реалистичные тестовые данные:
* Русские ФИО, телефоны
* Параметры велосипедов (размеры, вес, цены)
* Даты аренд
* Связи между таблицами
* `var faker = new Faker("ru");`
### **REST API на ASP.NET Core**
- CRUD-операции для всех сущностей (Bikes, BikeModels, Renters, Leases)
- Тесты xUnit адаптированы

#### Запуск и порты:
- Запустить проект через AppHost
- **Aspire Dashboard:** автоматически открывается при запуске
- **Adminer для БД:** доступен через Dashboard
- `https://localhost:21053` - для метрик
- `https://localhost:17195`
- `http://localhost:15246` - порты API
- Используется `launchSettings.json` с http и https

#### Администрирование БД через Adminer
1. в Aspire Dashboard
2. Найти контейнер `bike_rental_db_adminer`
3. Войти с данными:
* Система: MySQL 
* Сервер: `bike-rental-db` 
* Пользователь: `root`
* Пароль: `1234512345Aa$`
* База данных: bike-rental - не обязательно

### Swagger
- Для получения доступа к backend: `http://localhost:5043/swagger/index.html` -  клиент для тестирования